{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"ValidationContext\", {\n  enumerable: true,\n  get: function get() {\n    return _ValidationContext.default;\n  }\n});\nexports.SimpleSchema = exports.schemaDefinitionOptions = void 0;\n\nvar _clone = _interopRequireDefault(require(\"clone\"));\n\nvar _messageBox = _interopRequireDefault(require(\"message-box\"));\n\nvar _mongoObject = _interopRequireDefault(require(\"mongo-object\"));\n\nvar _humanize = _interopRequireDefault(require(\"./humanize\"));\n\nvar _ValidationContext = _interopRequireDefault(require(\"./ValidationContext\"));\n\nvar _SimpleSchemaGroup = _interopRequireDefault(require(\"./SimpleSchemaGroup\"));\n\nvar _regExp = _interopRequireDefault(require(\"./regExp\"));\n\nvar _clean2 = _interopRequireDefault(require(\"./clean\"));\n\nvar _expandShorthand = _interopRequireDefault(require(\"./expandShorthand\"));\n\nvar _utility = require(\"./utility\");\n\nvar _defaultMessages = _interopRequireDefault(require(\"./defaultMessages\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n} // Exported for tests\n\n\nvar schemaDefinitionOptions = ['type', 'label', 'optional', 'required', 'autoValue', 'defaultValue'];\nexports.schemaDefinitionOptions = schemaDefinitionOptions;\nvar oneOfProps = ['type', 'min', 'max', 'minCount', 'maxCount', 'allowedValues', 'exclusiveMin', 'exclusiveMax', 'regEx', 'custom', 'blackbox', 'trim'];\nvar propsThatCanBeFunction = ['label', 'optional', 'min', 'max', 'minCount', 'maxCount', 'allowedValues', 'exclusiveMin', 'exclusiveMax', 'regEx'];\n\nvar SimpleSchema = /*#__PURE__*/function () {\n  function SimpleSchema() {\n    var schema = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, SimpleSchema);\n\n    _defineProperty(this, \"pick\", getPickOrOmit('pick'));\n\n    _defineProperty(this, \"omit\", getPickOrOmit('omit')); // Stash the options object\n\n\n    this._constructorOptions = _objectSpread({}, SimpleSchema._constructorOptionDefaults, {}, options);\n    delete this._constructorOptions.clean; // stored separately below\n    // Schema-level defaults for cleaning\n\n    this._cleanOptions = _objectSpread({}, SimpleSchema._constructorOptionDefaults.clean, {}, options.clean || {}); // Custom validators for this instance\n\n    this._validators = [];\n    this._docValidators = []; // Named validation contexts\n\n    this._validationContexts = {}; // Clone, expanding shorthand, and store the schema object in this._schema\n\n    this._schema = {};\n    this._depsLabels = {};\n    this.extend(schema); // Define default validation error messages\n\n    this.messageBox = new _messageBox.default((0, _clone.default)(_defaultMessages.default));\n    this.version = SimpleSchema.version;\n  }\n\n  _createClass(SimpleSchema, [{\n    key: \"forEachAncestorSimpleSchema\",\n    value: function forEachAncestorSimpleSchema(key, func) {\n      var _this = this;\n\n      var genericKey = _mongoObject.default.makeKeyGeneric(key);\n\n      (0, _utility.forEachKeyAncestor)(genericKey, function (ancestor) {\n        var def = _this._schema[ancestor];\n        if (!def) return;\n        def.type.definitions.forEach(function (typeDef) {\n          if (SimpleSchema.isSimpleSchema(typeDef.type)) {\n            func(typeDef.type, ancestor, genericKey.slice(ancestor.length + 1));\n          }\n        });\n      });\n    }\n    /**\n     * Returns whether the obj is a SimpleSchema object.\n     * @param {Object} [obj] An object to test\n     * @returns {Boolean} True if the given object appears to be a SimpleSchema instance\n     */\n\n  }, {\n    key: \"reactiveLabelDependency\",\n\n    /**\n     * For Meteor apps, add a reactive dependency on the label\n     * for a key.\n     */\n    value: function reactiveLabelDependency(key) {\n      var tracker = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this._constructorOptions.tracker;\n      if (!key || !tracker) return;\n\n      var genericKey = _mongoObject.default.makeKeyGeneric(key); // If in this schema\n\n\n      if (this._schema[genericKey]) {\n        if (!this._depsLabels[genericKey]) {\n          this._depsLabels[genericKey] = new tracker.Dependency();\n        }\n\n        this._depsLabels[genericKey].depend();\n\n        return;\n      } // If in subschema\n\n\n      this.forEachAncestorSimpleSchema(key, function (simpleSchema, ancestor, subSchemaKey) {\n        // Pass tracker down so that we get reactivity even if the subschema\n        // didn't have tracker option set\n        simpleSchema.reactiveLabelDependency(subSchemaKey, tracker);\n      });\n    }\n    /**\n     * @param {String} key One specific or generic key for which to get the schema.\n     * @returns {[SimpleSchema, String]} Returns a 2-tuple.\n     *\n     *   First item: The SimpleSchema instance that actually defines the given key.\n     *\n     *   For example, if you have several nested objects, each their own SimpleSchema\n     *   instance, and you pass in 'outerObj.innerObj.innerestObj.name' as the key, you'll\n     *   get back the SimpleSchema instance for `outerObj.innerObj.innerestObj` key.\n     *\n     *   But if you pass in 'outerObj.innerObj.innerestObj.name' as the key and that key is\n     *   defined in the main schema without use of subschemas, then you'll get back the main schema.\n     *\n     *   Second item: The part of the key that is in the found schema.\n     *\n     *   Always returns a tuple (array) but the values may be `null`.\n     */\n\n  }, {\n    key: \"nearestSimpleSchemaInstance\",\n    value: function nearestSimpleSchemaInstance(key) {\n      if (!key) return [null, null];\n\n      var genericKey = _mongoObject.default.makeKeyGeneric(key);\n\n      if (this._schema[genericKey]) return [this, genericKey]; // If not defined in this schema, see if it's defined in a subschema\n\n      var innerKey;\n      var nearestSimpleSchemaInstance;\n      this.forEachAncestorSimpleSchema(key, function (simpleSchema, ancestor, subSchemaKey) {\n        if (!nearestSimpleSchemaInstance && simpleSchema._schema[subSchemaKey]) {\n          nearestSimpleSchemaInstance = simpleSchema;\n          innerKey = subSchemaKey;\n        }\n      });\n      return innerKey ? [nearestSimpleSchemaInstance, innerKey] : [null, null];\n    }\n    /**\n     * @param {String} [key] One specific or generic key for which to get the schema.\n     * @returns {Object} The entire schema object or just the definition for one key.\n     *\n     * Note that this returns the raw, unevaluated definition object. Use `getDefinition`\n     * if you want the evaluated definition, where any properties that are functions\n     * have been run to produce a result.\n     */\n\n  }, {\n    key: \"schema\",\n    value: function schema(key) {\n      if (!key) return this._schema;\n\n      var genericKey = _mongoObject.default.makeKeyGeneric(key);\n\n      var keySchema = this._schema[genericKey]; // If not defined in this schema, see if it's defined in a subschema\n\n      if (!keySchema) {\n        var found = false;\n        this.forEachAncestorSimpleSchema(key, function (simpleSchema, ancestor, subSchemaKey) {\n          if (!found) keySchema = simpleSchema.schema(subSchemaKey);\n          if (keySchema) found = true;\n        });\n      }\n\n      return keySchema;\n    }\n    /**\n     * @returns {Object} The entire schema object with subschemas merged. This is the\n     * equivalent of what schema() returned in SimpleSchema < 2.0\n     *\n     * Note that this returns the raw, unevaluated definition object. Use `getDefinition`\n     * if you want the evaluated definition, where any properties that are functions\n     * have been run to produce a result.\n     */\n\n  }, {\n    key: \"mergedSchema\",\n    value: function mergedSchema() {\n      var _this2 = this;\n\n      var mergedSchema = {};\n\n      this._schemaKeys.forEach(function (key) {\n        var keySchema = _this2._schema[key];\n        mergedSchema[key] = keySchema;\n        keySchema.type.definitions.forEach(function (typeDef) {\n          if (!SimpleSchema.isSimpleSchema(typeDef.type)) return;\n          var childSchema = typeDef.type.mergedSchema();\n          Object.keys(childSchema).forEach(function (subKey) {\n            mergedSchema[\"\".concat(key, \".\").concat(subKey)] = childSchema[subKey];\n          });\n        });\n      });\n\n      return mergedSchema;\n    }\n    /**\n     * Returns the evaluated definition for one key in the schema\n     *\n     * @param {String} key Generic or specific schema key\n     * @param {Array(String)} [propList] Array of schema properties you need; performance optimization\n     * @param {Object} [functionContext] The context to use when evaluating schema options that are functions\n     * @returns {Object} The schema definition for the requested key\n     */\n\n  }, {\n    key: \"getDefinition\",\n    value: function getDefinition(key, propList) {\n      var _this3 = this;\n\n      var functionContext = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var defs = this.schema(key);\n      if (!defs) return;\n\n      var getPropIterator = function getPropIterator(obj, newObj) {\n        return function (prop) {\n          if (Array.isArray(propList) && !propList.includes(prop)) return;\n          var val = obj[prop]; // For any options that support specifying a function, evaluate the functions\n\n          if (propsThatCanBeFunction.indexOf(prop) > -1 && typeof val === 'function') {\n            newObj[prop] = val.call(_objectSpread({\n              key: key\n            }, functionContext)); // Inflect label if undefined\n\n            if (prop === 'label' && typeof newObj[prop] !== 'string') newObj[prop] = inflectedLabel(key, _this3._constructorOptions.humanizeAutoLabels);\n          } else {\n            newObj[prop] = val;\n          }\n        };\n      };\n\n      var result = {};\n      Object.keys(defs).forEach(getPropIterator(defs, result)); // Resolve all the types and convert to a normal array to make it easier\n      // to use.\n\n      if (defs.type) {\n        result.type = defs.type.definitions.map(function (typeDef) {\n          var newTypeDef = {};\n          Object.keys(typeDef).forEach(getPropIterator(typeDef, newTypeDef));\n          return newTypeDef;\n        });\n      }\n\n      return result;\n    }\n    /**\n     * Returns a string identifying the best guess data type for a key. For keys\n     * that allow multiple types, the first type is used. This can be useful for\n     * building forms.\n     *\n     * @param {String} key Generic or specific schema key\n     * @returns {String} A type string. One of:\n     *  string, number, boolean, date, object, stringArray, numberArray, booleanArray,\n     *  dateArray, objectArray\n     */\n\n  }, {\n    key: \"getQuickTypeForKey\",\n    value: function getQuickTypeForKey(key) {\n      var type;\n      var fieldSchema = this.schema(key);\n      if (!fieldSchema) return;\n      var fieldType = fieldSchema.type.singleType;\n\n      if (fieldType === String) {\n        type = 'string';\n      } else if (fieldType === Number || fieldType === SimpleSchema.Integer) {\n        type = 'number';\n      } else if (fieldType === Boolean) {\n        type = 'boolean';\n      } else if (fieldType === Date) {\n        type = 'date';\n      } else if (fieldType === Array) {\n        var arrayItemFieldSchema = this.schema(\"\".concat(key, \".$\"));\n        if (!arrayItemFieldSchema) return;\n        var arrayItemFieldType = arrayItemFieldSchema.type.singleType;\n\n        if (arrayItemFieldType === String) {\n          type = 'stringArray';\n        } else if (arrayItemFieldType === Number || arrayItemFieldType === SimpleSchema.Integer) {\n          type = 'numberArray';\n        } else if (arrayItemFieldType === Boolean) {\n          type = 'booleanArray';\n        } else if (arrayItemFieldType === Date) {\n          type = 'dateArray';\n        } else if (arrayItemFieldType === Object || SimpleSchema.isSimpleSchema(arrayItemFieldType)) {\n          type = 'objectArray';\n        }\n      } else if (fieldType === Object) {\n        type = 'object';\n      }\n\n      return type;\n    }\n    /**\n     * Given a key that is an Object, returns a new SimpleSchema instance scoped to that object.\n     *\n     * @param {String} key Generic or specific schema key\n     */\n\n  }, {\n    key: \"getObjectSchema\",\n    value: function getObjectSchema(key) {\n      var newSchemaDef = {};\n\n      var genericKey = _mongoObject.default.makeKeyGeneric(key);\n\n      var searchString = \"\".concat(genericKey, \".\");\n      var mergedSchema = this.mergedSchema();\n      Object.keys(mergedSchema).forEach(function (k) {\n        if (k.indexOf(searchString) === 0) {\n          newSchemaDef[k.slice(searchString.length)] = mergedSchema[k];\n        }\n      });\n      return this._copyWithSchema(newSchemaDef);\n    } // Returns an array of all the autovalue functions, including those in subschemas all the\n    // way down the schema tree\n\n  }, {\n    key: \"autoValueFunctions\",\n    value: function autoValueFunctions() {\n      var _this4 = this;\n\n      var result = [].concat(this._autoValues);\n\n      this._schemaKeys.forEach(function (key) {\n        _this4._schema[key].type.definitions.forEach(function (typeDef) {\n          if (!SimpleSchema.isSimpleSchema(typeDef.type)) return;\n          result = result.concat(typeDef.type.autoValueFunctions().map(function (_ref) {\n            var func = _ref.func,\n                fieldName = _ref.fieldName,\n                closestSubschemaFieldName = _ref.closestSubschemaFieldName;\n            return {\n              func: func,\n              fieldName: \"\".concat(key, \".\").concat(fieldName),\n              closestSubschemaFieldName: closestSubschemaFieldName.length ? \"\".concat(key, \".\").concat(closestSubschemaFieldName) : key\n            };\n          }));\n        });\n      });\n\n      return result;\n    } // Returns an array of all the blackbox keys, including those in subschemas\n\n  }, {\n    key: \"blackboxKeys\",\n    value: function blackboxKeys() {\n      var _this5 = this;\n\n      var blackboxKeys = new Set(this._blackboxKeys);\n\n      this._schemaKeys.forEach(function (key) {\n        _this5._schema[key].type.definitions.forEach(function (typeDef) {\n          if (!SimpleSchema.isSimpleSchema(typeDef.type)) return;\n          typeDef.type.blackboxKeys().forEach(function (blackboxKey) {\n            blackboxKeys.add(\"\".concat(key, \".\").concat(blackboxKey));\n          });\n        });\n      });\n\n      return Array.from(blackboxKeys);\n    } // Check if the key is a nested dot-syntax key inside of a blackbox object\n\n  }, {\n    key: \"keyIsInBlackBox\",\n    value: function keyIsInBlackBox(key) {\n      var _this6 = this;\n\n      var isInBlackBox = false;\n      (0, _utility.forEachKeyAncestor)(_mongoObject.default.makeKeyGeneric(key), function (ancestor, remainder) {\n        if (_this6._blackboxKeys.has(ancestor)) {\n          isInBlackBox = true;\n        } else {\n          var testKeySchema = _this6.schema(ancestor);\n\n          if (testKeySchema) {\n            testKeySchema.type.definitions.forEach(function (typeDef) {\n              if (!SimpleSchema.isSimpleSchema(typeDef.type)) return;\n              if (typeDef.type.keyIsInBlackBox(remainder)) isInBlackBox = true;\n            });\n          }\n        }\n      });\n      return isInBlackBox;\n    } // Returns true if key is explicitly allowed by the schema or implied\n    // by other explicitly allowed keys.\n    // The key string should have $ in place of any numeric array positions.\n\n  }, {\n    key: \"allowsKey\",\n    value: function allowsKey(key) {\n      var _this7 = this; // Loop through all keys in the schema\n\n\n      return this._schemaKeys.some(function (loopKey) {\n        // If the schema key is the test key, it's allowed.\n        if (loopKey === key) return true;\n\n        var fieldSchema = _this7.schema(loopKey);\n\n        var compare1 = key.slice(0, loopKey.length + 2);\n        var compare2 = compare1.slice(0, -1); // Blackbox and subschema checks are needed only if key starts with\n        // loopKey + a dot\n\n        if (compare2 !== \"\".concat(loopKey, \".\")) return false; // Black box handling\n\n        if (_this7._blackboxKeys.has(loopKey)) {\n          // If the test key is the black box key + \".$\", then the test\n          // key is NOT allowed because black box keys are by definition\n          // only for objects, and not for arrays.\n          return compare1 !== \"\".concat(loopKey, \".$\");\n        } // Subschemas\n\n\n        var allowed = false;\n        var subKey = key.slice(loopKey.length + 1);\n        fieldSchema.type.definitions.forEach(function (typeDef) {\n          if (!SimpleSchema.isSimpleSchema(typeDef.type)) return;\n          if (typeDef.type.allowsKey(subKey)) allowed = true;\n        });\n        return allowed;\n      });\n    }\n    /**\n     * Returns all the child keys for the object identified by the generic prefix,\n     * or all the top level keys if no prefix is supplied.\n     *\n     * @param {String} [keyPrefix] The Object-type generic key for which to get child keys. Omit for\n     *   top-level Object-type keys\n     * @returns {[[Type]]} [[Description]]\n     */\n\n  }, {\n    key: \"objectKeys\",\n    value: function objectKeys(keyPrefix) {\n      if (!keyPrefix) return this._firstLevelSchemaKeys;\n      return this._objectKeys[\"\".concat(keyPrefix, \".\")] || [];\n    }\n    /**\n     * Copies this schema into a new instance with the same validators, messages,\n     * and options, but with different keys as defined in `schema` argument\n     *\n     * @param {Object} schema\n     * @returns The new SimpleSchema instance (chainable)\n     */\n\n  }, {\n    key: \"_copyWithSchema\",\n    value: function _copyWithSchema(schema) {\n      var cl = new SimpleSchema(schema, _objectSpread({}, this._constructorOptions));\n      cl._cleanOptions = this._cleanOptions;\n      cl.messageBox = this.messageBox.clone();\n      return cl;\n    }\n    /**\n     * Clones this schema into a new instance with the same schema keys, validators,\n     * and options.\n     *\n     * @returns The new SimpleSchema instance (chainable)\n     */\n\n  }, {\n    key: \"clone\",\n    value: function clone() {\n      return this._copyWithSchema(this._schema);\n    }\n    /**\n     * Extends (mutates) this schema with another schema, key by key.\n     *\n     * @param {SimpleSchema|Object} schema\n     * @returns The SimpleSchema instance (chainable)\n     */\n\n  }, {\n    key: \"extend\",\n    value: function extend() {\n      var _this8 = this;\n\n      var schema = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      if (Array.isArray(schema)) throw new Error('You may not pass an array of schemas to the SimpleSchema constructor or to extend()');\n      var schemaObj;\n\n      if (SimpleSchema.isSimpleSchema(schema)) {\n        schemaObj = schema._schema;\n        this._validators = this._validators.concat(schema._validators);\n        this._docValidators = this._docValidators.concat(schema._docValidators);\n        Object.assign(this._cleanOptions, schema._cleanOptions);\n        Object.assign(this._constructorOptions, schema._constructorOptions);\n      } else {\n        schemaObj = (0, _expandShorthand.default)(schema);\n      }\n\n      var schemaKeys = Object.keys(schemaObj);\n      var combinedKeys = new Set([].concat(_toConsumableArray(Object.keys(this._schema)), _toConsumableArray(schemaKeys))); // Update all of the information cached on the instance\n\n      schemaKeys.forEach(function (fieldName) {\n        var definition = standardizeDefinition(schemaObj[fieldName]); // Merge/extend with any existing definition\n\n        if (_this8._schema[fieldName]) {\n          if (!Object.prototype.hasOwnProperty.call(_this8._schema, fieldName)) {\n            // fieldName is actually a method from Object itself!\n            throw new Error(\"\".concat(fieldName, \" key is actually the name of a method on Object, please rename it\"));\n          }\n\n          var type = definition.type,\n              definitionWithoutType = _objectWithoutProperties(definition, [\"type\"]); // eslint-disable-line no-unused-vars\n\n\n          _this8._schema[fieldName] = _objectSpread({}, _this8._schema[fieldName], {}, definitionWithoutType);\n          if (definition.type) _this8._schema[fieldName].type.extend(definition.type);\n        } else {\n          _this8._schema[fieldName] = definition;\n        }\n\n        checkAndScrubDefinition(fieldName, _this8._schema[fieldName], _this8._constructorOptions, combinedKeys);\n      });\n      checkSchemaOverlap(this._schema); // Set/Reset all of these\n\n      this._schemaKeys = Object.keys(this._schema);\n      this._autoValues = [];\n      this._blackboxKeys = new Set();\n      this._firstLevelSchemaKeys = [];\n      this._objectKeys = {}; // Update all of the information cached on the instance\n\n      this._schemaKeys.forEach(function (fieldName) {\n        // Make sure parent has a definition in the schema. No implied objects!\n        if (fieldName.indexOf('.') > -1) {\n          var parentFieldName = fieldName.slice(0, fieldName.lastIndexOf('.'));\n          if (!Object.prototype.hasOwnProperty.call(_this8._schema, parentFieldName)) throw new Error(\"\\\"\".concat(fieldName, \"\\\" is in the schema but \\\"\").concat(parentFieldName, \"\\\" is not\"));\n        }\n\n        var definition = _this8._schema[fieldName]; // Keep list of all top level keys\n\n        if (fieldName.indexOf('.') === -1) _this8._firstLevelSchemaKeys.push(fieldName); // Keep list of all blackbox keys for passing to MongoObject constructor\n        // XXX For now if any oneOf type is blackbox, then the whole field is.\n\n        /* eslint-disable no-restricted-syntax */\n\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          for (var _iterator = definition.type.definitions[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var oneOfDef = _step.value; // XXX If the type is SS.Any, also consider it a blackbox\n\n            if (oneOfDef.blackbox === true || oneOfDef.type === SimpleSchema.Any) {\n              _this8._blackboxKeys.add(fieldName);\n\n              break;\n            }\n          }\n          /* eslint-enable no-restricted-syntax */\n          // Keep list of autoValue functions\n\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator.return != null) {\n              _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n\n        if (typeof definition.autoValue === 'function') {\n          _this8._autoValues.push({\n            closestSubschemaFieldName: '',\n            fieldName: fieldName,\n            func: definition.autoValue\n          });\n        }\n      }); // Store child keys keyed by parent. This needs to be done recursively to handle\n      // subschemas.\n\n\n      var setObjectKeys = function setObjectKeys(curSchema, schemaParentKey) {\n        Object.keys(curSchema).forEach(function (fieldName) {\n          var definition = curSchema[fieldName];\n          fieldName = schemaParentKey ? \"\".concat(schemaParentKey, \".\").concat(fieldName) : fieldName;\n\n          if (fieldName.indexOf('.') > -1 && fieldName.slice(-2) !== '.$') {\n            var parentKey = fieldName.slice(0, fieldName.lastIndexOf('.'));\n            var parentKeyWithDot = \"\".concat(parentKey, \".\");\n            _this8._objectKeys[parentKeyWithDot] = _this8._objectKeys[parentKeyWithDot] || [];\n\n            _this8._objectKeys[parentKeyWithDot].push(fieldName.slice(fieldName.lastIndexOf('.') + 1));\n          } // If the current field is a nested SimpleSchema,\n          // iterate over the child fields and cache their properties as well\n\n\n          definition.type.definitions.forEach(function (_ref2) {\n            var type = _ref2.type;\n\n            if (SimpleSchema.isSimpleSchema(type)) {\n              setObjectKeys(type._schema, fieldName);\n            }\n          });\n        });\n      };\n\n      setObjectKeys(this._schema);\n      return this;\n    }\n  }, {\n    key: \"getAllowedValuesForKey\",\n    value: function getAllowedValuesForKey(key) {\n      // For array fields, `allowedValues` is on the array item definition\n      if (this.allowsKey(\"\".concat(key, \".$\"))) {\n        key = \"\".concat(key, \".$\");\n      }\n\n      var allowedValues = this.get(key, 'allowedValues');\n\n      if (Array.isArray(allowedValues) || allowedValues instanceof Set) {\n        return _toConsumableArray(allowedValues);\n      }\n\n      return null;\n    }\n  }, {\n    key: \"newContext\",\n    value: function newContext() {\n      return new _ValidationContext.default(this);\n    }\n  }, {\n    key: \"namedContext\",\n    value: function namedContext(name) {\n      if (typeof name !== 'string') name = 'default';\n\n      if (!this._validationContexts[name]) {\n        this._validationContexts[name] = new _ValidationContext.default(this, name);\n      }\n\n      return this._validationContexts[name];\n    }\n  }, {\n    key: \"addValidator\",\n    value: function addValidator(func) {\n      this._validators.push(func);\n    }\n  }, {\n    key: \"addDocValidator\",\n    value: function addDocValidator(func) {\n      this._docValidators.push(func);\n    }\n    /**\n     * @param obj {Object|Object[]} Object or array of objects to validate.\n     * @param [options] {Object} Same options object that ValidationContext#validate takes\n     *\n     * Throws an Error with name `ClientError` and `details` property containing the errors.\n     */\n\n  }, {\n    key: \"validate\",\n    value: function validate(obj) {\n      var _this9 = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {}; // For Meteor apps, `check` option can be passed to silence audit-argument-checks\n\n      var check = options.check || this._constructorOptions.check;\n\n      if (typeof check === 'function') {\n        // Call check but ignore the error\n        try {\n          check(obj);\n        } catch (e) {\n          /* ignore error */\n        }\n      } // obj can be an array, in which case we validate each object in it and\n      // throw as soon as one has an error\n\n\n      var objects = Array.isArray(obj) ? obj : [obj];\n      objects.forEach(function (oneObj) {\n        var validationContext = _this9.newContext();\n\n        var isValid = validationContext.validate(oneObj, options);\n        if (isValid) return;\n        var errors = validationContext.validationErrors(); // In order for the message at the top of the stack trace to be useful,\n        // we set it to the first validation error message.\n\n        var message = _this9.messageForError(errors[0]);\n\n        var error = new Error(message);\n        error.errorType = 'ClientError';\n        error.name = 'ClientError';\n        error.error = 'validation-error'; // Add meaningful error messages for each validation error.\n        // Useful for display messages when using 'mdg:validated-method'.\n\n        error.details = errors.map(function (errorDetail) {\n          return _objectSpread({}, errorDetail, {\n            message: _this9.messageForError(errorDetail)\n          });\n        }); // The primary use for the validationErrorTransform is to convert the\n        // vanilla Error into a Meteor.Error until DDP is able to pass\n        // vanilla errors back to the client.\n\n        if (typeof SimpleSchema.validationErrorTransform === 'function') {\n          throw SimpleSchema.validationErrorTransform(error);\n        } else {\n          throw error;\n        }\n      });\n    }\n    /**\n     * @param obj {Object} Object to validate.\n     * @param [options] {Object} Same options object that ValidationContext#validate takes\n     *\n     * Returns a Promise that resolves with the errors\n     */\n\n  }, {\n    key: \"validateAndReturnErrorsPromise\",\n    value: function validateAndReturnErrorsPromise(obj, options) {\n      var _this10 = this;\n\n      var validationContext = this.newContext();\n      var isValid = validationContext.validate(obj, options);\n      if (isValid) return Promise.resolve([]); // Add the `message` prop\n\n      var errors = validationContext.validationErrors().map(function (errorDetail) {\n        return _objectSpread({}, errorDetail, {\n          message: _this10.messageForError(errorDetail)\n        });\n      });\n      return Promise.resolve(errors);\n    }\n  }, {\n    key: \"validator\",\n    value: function validator() {\n      var _this11 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      return function (obj) {\n        var optionsClone = _objectSpread({}, options);\n\n        if (options.clean === true) {\n          // Do this here and pass into both functions for better performance\n          optionsClone.mongoObject = new _mongoObject.default(obj, _this11.blackboxKeys());\n\n          _this11.clean(obj, optionsClone);\n        }\n\n        if (options.returnErrorsPromise) {\n          return _this11.validateAndReturnErrorsPromise(obj, optionsClone);\n        }\n\n        return _this11.validate(obj, optionsClone);\n      };\n    }\n  }, {\n    key: \"getFormValidator\",\n    value: function getFormValidator() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      return this.validator(_objectSpread({}, options, {\n        returnErrorsPromise: true\n      }));\n    }\n  }, {\n    key: \"clean\",\n    value: function clean() {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return _clean2.default.apply(void 0, [this].concat(args));\n    }\n    /**\n     * Change schema labels on the fly, causing mySchema.label computation\n     * to rerun. Useful when the user changes the language.\n     *\n     * @param {Object} labels A dictionary of all the new label values, by schema key.\n     */\n\n  }, {\n    key: \"labels\",\n    value: function labels(_labels) {\n      var _this12 = this;\n\n      Object.keys(_labels).forEach(function (key) {\n        var label = _labels[key];\n        if (typeof label !== 'string' && typeof label !== 'function') return;\n\n        var _this12$nearestSimple = _this12.nearestSimpleSchemaInstance(key),\n            _this12$nearestSimple2 = _slicedToArray(_this12$nearestSimple, 2),\n            schemaInstance = _this12$nearestSimple2[0],\n            innerKey = _this12$nearestSimple2[1];\n\n        if (!schemaInstance) return;\n        schemaInstance._schema[innerKey].label = label;\n        schemaInstance._depsLabels[innerKey] && schemaInstance._depsLabels[innerKey].changed();\n      });\n    }\n    /**\n     * Gets a field's label or all field labels reactively.\n     *\n     * @param {String} [key] The schema key, specific or generic.\n     *   Omit this argument to get a dictionary of all labels.\n     * @returns {String} The label\n     */\n\n  }, {\n    key: \"label\",\n    value: function label(key) {\n      var _this13 = this; // Get all labels\n\n\n      if (key === null || key === undefined) {\n        var result = {};\n\n        this._schemaKeys.forEach(function (schemaKey) {\n          result[schemaKey] = _this13.label(schemaKey);\n        });\n\n        return result;\n      } // Get label for one field\n\n\n      var label = this.get(key, 'label');\n      if (label) this.reactiveLabelDependency(key);\n      return label || null;\n    }\n    /**\n     * Gets a field's property\n     *\n     * @param {String} key The schema key, specific or generic.\n     * @param {String} prop Name of the property to get for that schema key\n     * @param {Object} [functionContext] The `this` context to use if prop is a function\n     * @returns {any} The property value\n     */\n\n  }, {\n    key: \"get\",\n    value: function get(key, prop, functionContext) {\n      var def = this.getDefinition(key, ['type', prop], functionContext);\n      if (!def) return undefined;\n\n      if (schemaDefinitionOptions.includes(prop)) {\n        return def[prop];\n      }\n\n      return (def.type.find(function (props) {\n        return props[prop];\n      }) || {})[prop];\n    } // shorthand for getting defaultValue\n\n  }, {\n    key: \"defaultValue\",\n    value: function defaultValue(key) {\n      return this.get(key, 'defaultValue');\n    } // Returns a string message for the given error type and key. Passes through\n    // to message-box pkg.\n\n  }, {\n    key: \"messageForError\",\n    value: function messageForError(errorInfo) {\n      var name = errorInfo.name;\n      return this.messageBox.message(errorInfo, {\n        context: {\n          key: name,\n          // backward compatibility\n          // The call to this.label() establishes a reactive dependency, too\n          label: this.label(name)\n        }\n      });\n    }\n    /**\n     * @method SimpleSchema#pick\n     * @param {[fields]} The list of fields to pick to instantiate the subschema\n     * @returns {SimpleSchema} The subschema\n     */\n\n  }], [{\n    key: \"isSimpleSchema\",\n    value: function isSimpleSchema(obj) {\n      return obj && (obj instanceof SimpleSchema || obj._schema);\n    }\n  }, {\n    key: \"extendOptions\",\n    // If you need to allow properties other than those listed above, call this from your app or package\n    value: function extendOptions(options) {\n      // For backwards compatibility we still take an object here, but we only care about the names\n      if (!Array.isArray(options)) options = Object.keys(options);\n      options.forEach(function (option) {\n        schemaDefinitionOptions.push(option);\n      });\n    }\n  }, {\n    key: \"defineValidationErrorTransform\",\n    value: function defineValidationErrorTransform(transform) {\n      if (typeof transform !== 'function') {\n        throw new Error('SimpleSchema.defineValidationErrorTransform must be passed a function that accepts an Error and returns an Error');\n      }\n\n      SimpleSchema.validationErrorTransform = transform;\n    }\n  }, {\n    key: \"validate\",\n    value: function validate(obj, schema, options) {\n      // Allow passing just the schema object\n      if (!SimpleSchema.isSimpleSchema(schema)) {\n        schema = new SimpleSchema(schema);\n      }\n\n      return schema.validate(obj, options);\n    }\n  }, {\n    key: \"oneOf\",\n    value: function oneOf() {\n      for (var _len2 = arguments.length, definitions = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        definitions[_key2] = arguments[_key2];\n      }\n\n      return _construct(_SimpleSchemaGroup.default, definitions);\n    }\n  }, {\n    key: \"addValidator\",\n    value: function addValidator(func) {\n      SimpleSchema._validators.push(func);\n    }\n  }, {\n    key: \"addDocValidator\",\n    value: function addDocValidator(func) {\n      SimpleSchema._docValidators.push(func);\n    } // Global constructor options\n\n  }, {\n    key: \"constructorOptionDefaults\",\n\n    /**\n     * @summary Get/set default values for SimpleSchema constructor options\n     */\n    value: function constructorOptionDefaults(options) {\n      if (!options) return SimpleSchema._constructorOptionDefaults;\n      SimpleSchema._constructorOptionDefaults = _objectSpread({}, SimpleSchema._constructorOptionDefaults, {}, options, {\n        clean: _objectSpread({}, SimpleSchema._constructorOptionDefaults.clean, {}, options.clean || {})\n      });\n    }\n  }]);\n\n  return SimpleSchema;\n}();\n/*\n * PRIVATE\n */\n// Throws an error if any fields are `type` SimpleSchema but then also\n// have subfields defined outside of that.\n\n\nexports.SimpleSchema = SimpleSchema;\n\n_defineProperty(SimpleSchema, \"version\", 2);\n\n_defineProperty(SimpleSchema, \"Any\", '___Any___');\n\n_defineProperty(SimpleSchema, \"RegEx\", _regExp.default);\n\n_defineProperty(SimpleSchema, \"_validators\", []);\n\n_defineProperty(SimpleSchema, \"_docValidators\", []);\n\n_defineProperty(SimpleSchema, \"_constructorOptionDefaults\", {\n  clean: {\n    autoConvert: true,\n    extendAutoValueContext: {},\n    filter: true,\n    getAutoValues: true,\n    removeEmptyStrings: true,\n    removeNullsFromArrays: false,\n    trimStrings: true\n  },\n  humanizeAutoLabels: true,\n  requiredByDefault: true\n});\n\n_defineProperty(SimpleSchema, \"ErrorTypes\", {\n  REQUIRED: 'required',\n  MIN_STRING: 'minString',\n  MAX_STRING: 'maxString',\n  MIN_NUMBER: 'minNumber',\n  MAX_NUMBER: 'maxNumber',\n  MIN_NUMBER_EXCLUSIVE: 'minNumberExclusive',\n  MAX_NUMBER_EXCLUSIVE: 'maxNumberExclusive',\n  MIN_DATE: 'minDate',\n  MAX_DATE: 'maxDate',\n  BAD_DATE: 'badDate',\n  MIN_COUNT: 'minCount',\n  MAX_COUNT: 'maxCount',\n  MUST_BE_INTEGER: 'noDecimal',\n  VALUE_NOT_ALLOWED: 'notAllowed',\n  EXPECTED_TYPE: 'expectedType',\n  FAILED_REGULAR_EXPRESSION: 'regEx',\n  KEY_NOT_IN_SCHEMA: 'keyNotInSchema'\n});\n\n_defineProperty(SimpleSchema, \"Integer\", 'SimpleSchema.Integer');\n\n_defineProperty(SimpleSchema, \"_makeGeneric\", _mongoObject.default.makeKeyGeneric);\n\n_defineProperty(SimpleSchema, \"ValidationContext\", _ValidationContext.default);\n\n_defineProperty(SimpleSchema, \"setDefaultMessages\", function (messages) {\n  (0, _utility.merge)(_defaultMessages.default, messages);\n});\n\nfunction checkSchemaOverlap(schema) {\n  Object.keys(schema).forEach(function (key) {\n    var val = schema[key];\n    if (!val.type) throw new Error(\"\".concat(key, \" key is missing \\\"type\\\"\"));\n    val.type.definitions.forEach(function (def) {\n      if (!SimpleSchema.isSimpleSchema(def.type)) return;\n      Object.keys(def.type._schema).forEach(function (subKey) {\n        var newKey = \"\".concat(key, \".\").concat(subKey);\n\n        if (Object.prototype.hasOwnProperty.call(schema, newKey)) {\n          throw new Error(\"The type for \\\"\".concat(key, \"\\\" is set to a SimpleSchema instance that defines \\\"\").concat(key, \".\").concat(subKey, \"\\\", but the parent SimpleSchema instance also tries to define \\\"\").concat(key, \".\").concat(subKey, \"\\\"\"));\n        }\n      });\n    });\n  });\n}\n/**\n * @param {String} fieldName The full generic schema key\n * @param {Boolean} shouldHumanize Humanize it\n * @returns {String} A label based on the key\n */\n\n\nfunction inflectedLabel(fieldName, shouldHumanize) {\n  var pieces = fieldName.split('.');\n  var label;\n\n  do {\n    label = pieces.pop();\n  } while (label === '$' && pieces.length);\n\n  return shouldHumanize ? (0, _humanize.default)(label) : label;\n}\n\nfunction getDefaultAutoValueFunction(defaultValue) {\n  return function defaultAutoValueFunction() {\n    if (this.isSet) return;\n    if (this.operator === null) return defaultValue; // Handle the case when pulling an object from an array the object contains a field\n    // which has a defaultValue. We don't want the default value to be returned in this case\n\n    if (this.operator === '$pull') return; // Handle the case where we are $pushing an object into an array of objects and we\n    // want any fields missing from that object to be added if they have default values\n\n    if (this.operator === '$push') return defaultValue; // If parent is set, we should update this position instead of $setOnInsert\n\n    if (this.parentField().isSet) return defaultValue; // Make sure the default value is added on upsert insert\n\n    if (this.isUpsert) return {\n      $setOnInsert: defaultValue\n    };\n  };\n} // Mutates def into standardized object with SimpleSchemaGroup type\n\n\nfunction standardizeDefinition(def) {\n  var standardizedDef = Object.keys(def).reduce(function (newDef, prop) {\n    if (!oneOfProps.includes(prop)) {\n      newDef[prop] = def[prop];\n    }\n\n    return newDef;\n  }, {}); // Internally, all definition types are stored as groups for simplicity of access.\n  // If we are extending, there may not actually be def.type, but it's okay because\n  // it will be added later when the two SimpleSchemaGroups are merged.\n\n  if (def.type && def.type instanceof _SimpleSchemaGroup.default) {\n    standardizedDef.type = def.type.clone();\n  } else {\n    var groupProps = Object.keys(def).reduce(function (newDef, prop) {\n      if (oneOfProps.includes(prop)) {\n        newDef[prop] = def[prop];\n      }\n\n      return newDef;\n    }, {});\n    standardizedDef.type = new _SimpleSchemaGroup.default(groupProps);\n  }\n\n  return standardizedDef;\n}\n/**\n * @summary Checks and mutates definition. Clone it first.\n *   Throws errors if any problems are found.\n * @param {String} fieldName Name of field / key\n * @param {Object} definition Field definition\n * @param {Object} options Options\n * @param {Set} allKeys Set of all field names / keys in entire schema\n * @return {undefined} Void\n */\n\n\nfunction checkAndScrubDefinition(fieldName, definition, options, allKeys) {\n  if (!definition.type) throw new Error(\"\".concat(fieldName, \" key is missing \\\"type\\\"\")); // Validate the field definition\n\n  Object.keys(definition).forEach(function (key) {\n    if (schemaDefinitionOptions.indexOf(key) === -1) {\n      throw new Error(\"Invalid definition for \".concat(fieldName, \" field: \\\"\").concat(key, \"\\\" is not a supported property\"));\n    }\n  }); // Make sure the `type`s are OK\n\n  var couldBeArray = false;\n  definition.type.definitions.forEach(function (_ref3) {\n    var type = _ref3.type;\n    if (!type) throw new Error(\"Invalid definition for \".concat(fieldName, \" field: \\\"type\\\" option is required\"));\n\n    if (Array.isArray(type)) {\n      throw new Error(\"Invalid definition for \".concat(fieldName, \" field: \\\"type\\\" may not be an array. Change it to Array.\"));\n    }\n\n    if (type.constructor === Object && (0, _utility.isEmptyObject)(type)) {\n      throw new Error(\"Invalid definition for \".concat(fieldName, \" field: \\\"type\\\" may not be an object. Change it to Object\"));\n    }\n\n    if (type === Array) couldBeArray = true;\n\n    if (SimpleSchema.isSimpleSchema(type)) {\n      Object.keys(type._schema).forEach(function (subKey) {\n        var newKey = \"\".concat(fieldName, \".\").concat(subKey);\n\n        if (allKeys.has(newKey)) {\n          throw new Error(\"The type for \\\"\".concat(fieldName, \"\\\" is set to a SimpleSchema instance that defines \\\"\").concat(newKey, \"\\\", but the parent SimpleSchema instance also tries to define \\\"\").concat(newKey, \"\\\"\"));\n        }\n      });\n    }\n  }); // If at least one of the possible types is Array, then make sure we have a\n  // definition for the array items, too.\n\n  if (couldBeArray && !allKeys.has(\"\".concat(fieldName, \".$\"))) {\n    throw new Error(\"\\\"\".concat(fieldName, \"\\\" is Array type but the schema does not include a \\\"\").concat(fieldName, \".$\\\" definition for the array items\\\"\"));\n  } // defaultValue -> autoValue\n  // We support defaultValue shortcut by converting it immediately into an\n  // autoValue.\n\n\n  if ('defaultValue' in definition) {\n    if ('autoValue' in definition && !definition.autoValue.isDefault) {\n      console.warn(\"SimpleSchema: Found both autoValue and defaultValue options for \\\"\".concat(fieldName, \"\\\". Ignoring defaultValue.\"));\n    } else {\n      if (fieldName.endsWith('.$')) {\n        throw new Error('An array item field (one that ends with \".$\") cannot have defaultValue.');\n      }\n\n      definition.autoValue = getDefaultAutoValueFunction(definition.defaultValue);\n      definition.autoValue.isDefault = true;\n    }\n  } // REQUIREDNESS\n\n\n  if (fieldName.endsWith('.$')) {\n    definition.optional = true;\n  } else if (!Object.prototype.hasOwnProperty.call(definition, 'optional')) {\n    if (Object.prototype.hasOwnProperty.call(definition, 'required')) {\n      if (typeof definition.required === 'function') {\n        definition.optional = function optional() {\n          for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n            args[_key3] = arguments[_key3];\n          }\n\n          return !definition.required.apply(this, args);\n        };\n      } else {\n        definition.optional = !definition.required;\n      }\n    } else {\n      definition.optional = options.requiredByDefault === false;\n    }\n  }\n\n  delete definition.required; // LABELS\n\n  if (!Object.prototype.hasOwnProperty.call(definition, 'label')) {\n    if (options.defaultLabel) {\n      definition.label = options.defaultLabel;\n    } else if (SimpleSchema.defaultLabel) {\n      definition.label = SimpleSchema.defaultLabel;\n    } else {\n      definition.label = inflectedLabel(fieldName, options.humanizeAutoLabels);\n    }\n  }\n}\n\nfunction getPickOrOmit(type) {\n  return function pickOrOmit() {\n    var _this14 = this;\n\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    } // If they are picking/omitting an object or array field, we need to also include everything under it\n\n\n    var newSchema = {};\n\n    this._schemaKeys.forEach(function (key) {\n      // Pick/omit it if it IS in the array of keys they want OR if it\n      // STARTS WITH something that is in the array plus a period\n      var includeIt = args.some(function (wantedField) {\n        return key === wantedField || key.indexOf(\"\".concat(wantedField, \".\")) === 0;\n      });\n\n      if (includeIt && type === 'pick' || !includeIt && type === 'omit') {\n        newSchema[key] = _this14._schema[key];\n      }\n    });\n\n    return this._copyWithSchema(newSchema);\n  };\n}","map":{"version":3,"sources":["/Users/joshisj/IdeaProjects/secondary/node_modules/simpl-schema/dist/SimpleSchema.js"],"names":["Object","defineProperty","exports","value","enumerable","get","_ValidationContext","default","SimpleSchema","schemaDefinitionOptions","_clone","_interopRequireDefault","require","_messageBox","_mongoObject","_humanize","_SimpleSchemaGroup","_regExp","_clean2","_expandShorthand","_utility","_defaultMessages","obj","__esModule","isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","prototype","toString","call","e","_construct","Parent","args","Class","a","push","apply","Constructor","Function","bind","instance","_setPrototypeOf","arguments","o","p","setPrototypeOf","__proto__","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","TypeError","Symbol","iterator","_arr","_n","_d","_e","undefined","_i","_s","next","done","length","err","Array","isArray","_objectWithoutProperties","source","excluded","target","_objectWithoutPropertiesLoose","key","getOwnPropertySymbols","sourceSymbolKeys","indexOf","propertyIsEnumerable","sourceKeys","keys","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","iter","from","arr2","ownKeys","object","enumerableOnly","symbols","filter","sym","getOwnPropertyDescriptor","_objectSpread","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_classCallCheck","_defineProperties","props","descriptor","configurable","writable","_createClass","protoProps","staticProps","oneOfProps","propsThatCanBeFunction","schema","options","getPickOrOmit","_constructorOptions","_constructorOptionDefaults","clean","_cleanOptions","_validators","_docValidators","_validationContexts","_schema","_depsLabels","extend","messageBox","version","forEachAncestorSimpleSchema","func","_this","genericKey","makeKeyGeneric","forEachKeyAncestor","ancestor","def","type","definitions","typeDef","isSimpleSchema","slice","reactiveLabelDependency","tracker","Dependency","depend","simpleSchema","subSchemaKey","nearestSimpleSchemaInstance","innerKey","keySchema","found","mergedSchema","_this2","_schemaKeys","childSchema","subKey","concat","getDefinition","propList","_this3","functionContext","defs","getPropIterator","newObj","prop","includes","val","inflectedLabel","humanizeAutoLabels","result","map","newTypeDef","getQuickTypeForKey","fieldSchema","fieldType","singleType","String","Number","Integer","Boolean","arrayItemFieldSchema","arrayItemFieldType","getObjectSchema","newSchemaDef","searchString","k","_copyWithSchema","autoValueFunctions","_this4","_autoValues","_ref","fieldName","closestSubschemaFieldName","blackboxKeys","_this5","Set","_blackboxKeys","blackboxKey","add","keyIsInBlackBox","_this6","isInBlackBox","remainder","has","testKeySchema","allowsKey","_this7","some","loopKey","compare1","compare2","allowed","objectKeys","keyPrefix","_firstLevelSchemaKeys","_objectKeys","cl","clone","_this8","Error","schemaObj","assign","schemaKeys","combinedKeys","definition","standardizeDefinition","hasOwnProperty","definitionWithoutType","checkAndScrubDefinition","checkSchemaOverlap","parentFieldName","lastIndexOf","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","oneOfDef","blackbox","Any","return","autoValue","setObjectKeys","curSchema","schemaParentKey","parentKey","parentKeyWithDot","_ref2","getAllowedValuesForKey","allowedValues","newContext","namedContext","name","addValidator","addDocValidator","validate","_this9","check","objects","oneObj","validationContext","isValid","errors","validationErrors","message","messageForError","error","errorType","details","errorDetail","validationErrorTransform","validateAndReturnErrorsPromise","_this10","Promise","resolve","validator","_this11","optionsClone","mongoObject","returnErrorsPromise","getFormValidator","_len","_key","labels","_labels","_this12","label","_this12$nearestSimple","_this12$nearestSimple2","schemaInstance","changed","_this13","schemaKey","find","defaultValue","errorInfo","context","extendOptions","option","defineValidationErrorTransform","transform","oneOf","_len2","_key2","constructorOptionDefaults","autoConvert","extendAutoValueContext","getAutoValues","removeEmptyStrings","removeNullsFromArrays","trimStrings","requiredByDefault","REQUIRED","MIN_STRING","MAX_STRING","MIN_NUMBER","MAX_NUMBER","MIN_NUMBER_EXCLUSIVE","MAX_NUMBER_EXCLUSIVE","MIN_DATE","MAX_DATE","BAD_DATE","MIN_COUNT","MAX_COUNT","MUST_BE_INTEGER","VALUE_NOT_ALLOWED","EXPECTED_TYPE","FAILED_REGULAR_EXPRESSION","KEY_NOT_IN_SCHEMA","messages","merge","newKey","shouldHumanize","pieces","split","pop","getDefaultAutoValueFunction","defaultAutoValueFunction","isSet","operator","parentField","isUpsert","$setOnInsert","standardizedDef","reduce","newDef","groupProps","allKeys","couldBeArray","_ref3","constructor","isEmptyObject","isDefault","console","warn","endsWith","optional","required","_len3","_key3","defaultLabel","pickOrOmit","_this14","_len4","_key4","newSchema","includeIt","wantedField"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"ValidationContext\", {\n  enumerable: true,\n  get: function get() {\n    return _ValidationContext.default;\n  }\n});\nexports.SimpleSchema = exports.schemaDefinitionOptions = void 0;\n\nvar _clone = _interopRequireDefault(require(\"clone\"));\n\nvar _messageBox = _interopRequireDefault(require(\"message-box\"));\n\nvar _mongoObject = _interopRequireDefault(require(\"mongo-object\"));\n\nvar _humanize = _interopRequireDefault(require(\"./humanize\"));\n\nvar _ValidationContext = _interopRequireDefault(require(\"./ValidationContext\"));\n\nvar _SimpleSchemaGroup = _interopRequireDefault(require(\"./SimpleSchemaGroup\"));\n\nvar _regExp = _interopRequireDefault(require(\"./regExp\"));\n\nvar _clean2 = _interopRequireDefault(require(\"./clean\"));\n\nvar _expandShorthand = _interopRequireDefault(require(\"./expandShorthand\"));\n\nvar _utility = require(\"./utility\");\n\nvar _defaultMessages = _interopRequireDefault(require(\"./defaultMessages\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _construct(Parent, args, Class) { if (isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) { return; } var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n// Exported for tests\nvar schemaDefinitionOptions = ['type', 'label', 'optional', 'required', 'autoValue', 'defaultValue'];\nexports.schemaDefinitionOptions = schemaDefinitionOptions;\nvar oneOfProps = ['type', 'min', 'max', 'minCount', 'maxCount', 'allowedValues', 'exclusiveMin', 'exclusiveMax', 'regEx', 'custom', 'blackbox', 'trim'];\nvar propsThatCanBeFunction = ['label', 'optional', 'min', 'max', 'minCount', 'maxCount', 'allowedValues', 'exclusiveMin', 'exclusiveMax', 'regEx'];\n\nvar SimpleSchema =\n/*#__PURE__*/\nfunction () {\n  function SimpleSchema() {\n    var schema = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, SimpleSchema);\n\n    _defineProperty(this, \"pick\", getPickOrOmit('pick'));\n\n    _defineProperty(this, \"omit\", getPickOrOmit('omit'));\n\n    // Stash the options object\n    this._constructorOptions = _objectSpread({}, SimpleSchema._constructorOptionDefaults, {}, options);\n    delete this._constructorOptions.clean; // stored separately below\n    // Schema-level defaults for cleaning\n\n    this._cleanOptions = _objectSpread({}, SimpleSchema._constructorOptionDefaults.clean, {}, options.clean || {}); // Custom validators for this instance\n\n    this._validators = [];\n    this._docValidators = []; // Named validation contexts\n\n    this._validationContexts = {}; // Clone, expanding shorthand, and store the schema object in this._schema\n\n    this._schema = {};\n    this._depsLabels = {};\n    this.extend(schema); // Define default validation error messages\n\n    this.messageBox = new _messageBox.default((0, _clone.default)(_defaultMessages.default));\n    this.version = SimpleSchema.version;\n  }\n\n  _createClass(SimpleSchema, [{\n    key: \"forEachAncestorSimpleSchema\",\n    value: function forEachAncestorSimpleSchema(key, func) {\n      var _this = this;\n\n      var genericKey = _mongoObject.default.makeKeyGeneric(key);\n\n      (0, _utility.forEachKeyAncestor)(genericKey, function (ancestor) {\n        var def = _this._schema[ancestor];\n        if (!def) return;\n        def.type.definitions.forEach(function (typeDef) {\n          if (SimpleSchema.isSimpleSchema(typeDef.type)) {\n            func(typeDef.type, ancestor, genericKey.slice(ancestor.length + 1));\n          }\n        });\n      });\n    }\n    /**\n     * Returns whether the obj is a SimpleSchema object.\n     * @param {Object} [obj] An object to test\n     * @returns {Boolean} True if the given object appears to be a SimpleSchema instance\n     */\n\n  }, {\n    key: \"reactiveLabelDependency\",\n\n    /**\n     * For Meteor apps, add a reactive dependency on the label\n     * for a key.\n     */\n    value: function reactiveLabelDependency(key) {\n      var tracker = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this._constructorOptions.tracker;\n      if (!key || !tracker) return;\n\n      var genericKey = _mongoObject.default.makeKeyGeneric(key); // If in this schema\n\n\n      if (this._schema[genericKey]) {\n        if (!this._depsLabels[genericKey]) {\n          this._depsLabels[genericKey] = new tracker.Dependency();\n        }\n\n        this._depsLabels[genericKey].depend();\n\n        return;\n      } // If in subschema\n\n\n      this.forEachAncestorSimpleSchema(key, function (simpleSchema, ancestor, subSchemaKey) {\n        // Pass tracker down so that we get reactivity even if the subschema\n        // didn't have tracker option set\n        simpleSchema.reactiveLabelDependency(subSchemaKey, tracker);\n      });\n    }\n    /**\n     * @param {String} key One specific or generic key for which to get the schema.\n     * @returns {[SimpleSchema, String]} Returns a 2-tuple.\n     *\n     *   First item: The SimpleSchema instance that actually defines the given key.\n     *\n     *   For example, if you have several nested objects, each their own SimpleSchema\n     *   instance, and you pass in 'outerObj.innerObj.innerestObj.name' as the key, you'll\n     *   get back the SimpleSchema instance for `outerObj.innerObj.innerestObj` key.\n     *\n     *   But if you pass in 'outerObj.innerObj.innerestObj.name' as the key and that key is\n     *   defined in the main schema without use of subschemas, then you'll get back the main schema.\n     *\n     *   Second item: The part of the key that is in the found schema.\n     *\n     *   Always returns a tuple (array) but the values may be `null`.\n     */\n\n  }, {\n    key: \"nearestSimpleSchemaInstance\",\n    value: function nearestSimpleSchemaInstance(key) {\n      if (!key) return [null, null];\n\n      var genericKey = _mongoObject.default.makeKeyGeneric(key);\n\n      if (this._schema[genericKey]) return [this, genericKey]; // If not defined in this schema, see if it's defined in a subschema\n\n      var innerKey;\n      var nearestSimpleSchemaInstance;\n      this.forEachAncestorSimpleSchema(key, function (simpleSchema, ancestor, subSchemaKey) {\n        if (!nearestSimpleSchemaInstance && simpleSchema._schema[subSchemaKey]) {\n          nearestSimpleSchemaInstance = simpleSchema;\n          innerKey = subSchemaKey;\n        }\n      });\n      return innerKey ? [nearestSimpleSchemaInstance, innerKey] : [null, null];\n    }\n    /**\n     * @param {String} [key] One specific or generic key for which to get the schema.\n     * @returns {Object} The entire schema object or just the definition for one key.\n     *\n     * Note that this returns the raw, unevaluated definition object. Use `getDefinition`\n     * if you want the evaluated definition, where any properties that are functions\n     * have been run to produce a result.\n     */\n\n  }, {\n    key: \"schema\",\n    value: function schema(key) {\n      if (!key) return this._schema;\n\n      var genericKey = _mongoObject.default.makeKeyGeneric(key);\n\n      var keySchema = this._schema[genericKey]; // If not defined in this schema, see if it's defined in a subschema\n\n      if (!keySchema) {\n        var found = false;\n        this.forEachAncestorSimpleSchema(key, function (simpleSchema, ancestor, subSchemaKey) {\n          if (!found) keySchema = simpleSchema.schema(subSchemaKey);\n          if (keySchema) found = true;\n        });\n      }\n\n      return keySchema;\n    }\n    /**\n     * @returns {Object} The entire schema object with subschemas merged. This is the\n     * equivalent of what schema() returned in SimpleSchema < 2.0\n     *\n     * Note that this returns the raw, unevaluated definition object. Use `getDefinition`\n     * if you want the evaluated definition, where any properties that are functions\n     * have been run to produce a result.\n     */\n\n  }, {\n    key: \"mergedSchema\",\n    value: function mergedSchema() {\n      var _this2 = this;\n\n      var mergedSchema = {};\n\n      this._schemaKeys.forEach(function (key) {\n        var keySchema = _this2._schema[key];\n        mergedSchema[key] = keySchema;\n        keySchema.type.definitions.forEach(function (typeDef) {\n          if (!SimpleSchema.isSimpleSchema(typeDef.type)) return;\n          var childSchema = typeDef.type.mergedSchema();\n          Object.keys(childSchema).forEach(function (subKey) {\n            mergedSchema[\"\".concat(key, \".\").concat(subKey)] = childSchema[subKey];\n          });\n        });\n      });\n\n      return mergedSchema;\n    }\n    /**\n     * Returns the evaluated definition for one key in the schema\n     *\n     * @param {String} key Generic or specific schema key\n     * @param {Array(String)} [propList] Array of schema properties you need; performance optimization\n     * @param {Object} [functionContext] The context to use when evaluating schema options that are functions\n     * @returns {Object} The schema definition for the requested key\n     */\n\n  }, {\n    key: \"getDefinition\",\n    value: function getDefinition(key, propList) {\n      var _this3 = this;\n\n      var functionContext = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var defs = this.schema(key);\n      if (!defs) return;\n\n      var getPropIterator = function getPropIterator(obj, newObj) {\n        return function (prop) {\n          if (Array.isArray(propList) && !propList.includes(prop)) return;\n          var val = obj[prop]; // For any options that support specifying a function, evaluate the functions\n\n          if (propsThatCanBeFunction.indexOf(prop) > -1 && typeof val === 'function') {\n            newObj[prop] = val.call(_objectSpread({\n              key: key\n            }, functionContext)); // Inflect label if undefined\n\n            if (prop === 'label' && typeof newObj[prop] !== 'string') newObj[prop] = inflectedLabel(key, _this3._constructorOptions.humanizeAutoLabels);\n          } else {\n            newObj[prop] = val;\n          }\n        };\n      };\n\n      var result = {};\n      Object.keys(defs).forEach(getPropIterator(defs, result)); // Resolve all the types and convert to a normal array to make it easier\n      // to use.\n\n      if (defs.type) {\n        result.type = defs.type.definitions.map(function (typeDef) {\n          var newTypeDef = {};\n          Object.keys(typeDef).forEach(getPropIterator(typeDef, newTypeDef));\n          return newTypeDef;\n        });\n      }\n\n      return result;\n    }\n    /**\n     * Returns a string identifying the best guess data type for a key. For keys\n     * that allow multiple types, the first type is used. This can be useful for\n     * building forms.\n     *\n     * @param {String} key Generic or specific schema key\n     * @returns {String} A type string. One of:\n     *  string, number, boolean, date, object, stringArray, numberArray, booleanArray,\n     *  dateArray, objectArray\n     */\n\n  }, {\n    key: \"getQuickTypeForKey\",\n    value: function getQuickTypeForKey(key) {\n      var type;\n      var fieldSchema = this.schema(key);\n      if (!fieldSchema) return;\n      var fieldType = fieldSchema.type.singleType;\n\n      if (fieldType === String) {\n        type = 'string';\n      } else if (fieldType === Number || fieldType === SimpleSchema.Integer) {\n        type = 'number';\n      } else if (fieldType === Boolean) {\n        type = 'boolean';\n      } else if (fieldType === Date) {\n        type = 'date';\n      } else if (fieldType === Array) {\n        var arrayItemFieldSchema = this.schema(\"\".concat(key, \".$\"));\n        if (!arrayItemFieldSchema) return;\n        var arrayItemFieldType = arrayItemFieldSchema.type.singleType;\n\n        if (arrayItemFieldType === String) {\n          type = 'stringArray';\n        } else if (arrayItemFieldType === Number || arrayItemFieldType === SimpleSchema.Integer) {\n          type = 'numberArray';\n        } else if (arrayItemFieldType === Boolean) {\n          type = 'booleanArray';\n        } else if (arrayItemFieldType === Date) {\n          type = 'dateArray';\n        } else if (arrayItemFieldType === Object || SimpleSchema.isSimpleSchema(arrayItemFieldType)) {\n          type = 'objectArray';\n        }\n      } else if (fieldType === Object) {\n        type = 'object';\n      }\n\n      return type;\n    }\n    /**\n     * Given a key that is an Object, returns a new SimpleSchema instance scoped to that object.\n     *\n     * @param {String} key Generic or specific schema key\n     */\n\n  }, {\n    key: \"getObjectSchema\",\n    value: function getObjectSchema(key) {\n      var newSchemaDef = {};\n\n      var genericKey = _mongoObject.default.makeKeyGeneric(key);\n\n      var searchString = \"\".concat(genericKey, \".\");\n      var mergedSchema = this.mergedSchema();\n      Object.keys(mergedSchema).forEach(function (k) {\n        if (k.indexOf(searchString) === 0) {\n          newSchemaDef[k.slice(searchString.length)] = mergedSchema[k];\n        }\n      });\n      return this._copyWithSchema(newSchemaDef);\n    } // Returns an array of all the autovalue functions, including those in subschemas all the\n    // way down the schema tree\n\n  }, {\n    key: \"autoValueFunctions\",\n    value: function autoValueFunctions() {\n      var _this4 = this;\n\n      var result = [].concat(this._autoValues);\n\n      this._schemaKeys.forEach(function (key) {\n        _this4._schema[key].type.definitions.forEach(function (typeDef) {\n          if (!SimpleSchema.isSimpleSchema(typeDef.type)) return;\n          result = result.concat(typeDef.type.autoValueFunctions().map(function (_ref) {\n            var func = _ref.func,\n                fieldName = _ref.fieldName,\n                closestSubschemaFieldName = _ref.closestSubschemaFieldName;\n            return {\n              func: func,\n              fieldName: \"\".concat(key, \".\").concat(fieldName),\n              closestSubschemaFieldName: closestSubschemaFieldName.length ? \"\".concat(key, \".\").concat(closestSubschemaFieldName) : key\n            };\n          }));\n        });\n      });\n\n      return result;\n    } // Returns an array of all the blackbox keys, including those in subschemas\n\n  }, {\n    key: \"blackboxKeys\",\n    value: function blackboxKeys() {\n      var _this5 = this;\n\n      var blackboxKeys = new Set(this._blackboxKeys);\n\n      this._schemaKeys.forEach(function (key) {\n        _this5._schema[key].type.definitions.forEach(function (typeDef) {\n          if (!SimpleSchema.isSimpleSchema(typeDef.type)) return;\n          typeDef.type.blackboxKeys().forEach(function (blackboxKey) {\n            blackboxKeys.add(\"\".concat(key, \".\").concat(blackboxKey));\n          });\n        });\n      });\n\n      return Array.from(blackboxKeys);\n    } // Check if the key is a nested dot-syntax key inside of a blackbox object\n\n  }, {\n    key: \"keyIsInBlackBox\",\n    value: function keyIsInBlackBox(key) {\n      var _this6 = this;\n\n      var isInBlackBox = false;\n      (0, _utility.forEachKeyAncestor)(_mongoObject.default.makeKeyGeneric(key), function (ancestor, remainder) {\n        if (_this6._blackboxKeys.has(ancestor)) {\n          isInBlackBox = true;\n        } else {\n          var testKeySchema = _this6.schema(ancestor);\n\n          if (testKeySchema) {\n            testKeySchema.type.definitions.forEach(function (typeDef) {\n              if (!SimpleSchema.isSimpleSchema(typeDef.type)) return;\n              if (typeDef.type.keyIsInBlackBox(remainder)) isInBlackBox = true;\n            });\n          }\n        }\n      });\n      return isInBlackBox;\n    } // Returns true if key is explicitly allowed by the schema or implied\n    // by other explicitly allowed keys.\n    // The key string should have $ in place of any numeric array positions.\n\n  }, {\n    key: \"allowsKey\",\n    value: function allowsKey(key) {\n      var _this7 = this;\n\n      // Loop through all keys in the schema\n      return this._schemaKeys.some(function (loopKey) {\n        // If the schema key is the test key, it's allowed.\n        if (loopKey === key) return true;\n\n        var fieldSchema = _this7.schema(loopKey);\n\n        var compare1 = key.slice(0, loopKey.length + 2);\n        var compare2 = compare1.slice(0, -1); // Blackbox and subschema checks are needed only if key starts with\n        // loopKey + a dot\n\n        if (compare2 !== \"\".concat(loopKey, \".\")) return false; // Black box handling\n\n        if (_this7._blackboxKeys.has(loopKey)) {\n          // If the test key is the black box key + \".$\", then the test\n          // key is NOT allowed because black box keys are by definition\n          // only for objects, and not for arrays.\n          return compare1 !== \"\".concat(loopKey, \".$\");\n        } // Subschemas\n\n\n        var allowed = false;\n        var subKey = key.slice(loopKey.length + 1);\n        fieldSchema.type.definitions.forEach(function (typeDef) {\n          if (!SimpleSchema.isSimpleSchema(typeDef.type)) return;\n          if (typeDef.type.allowsKey(subKey)) allowed = true;\n        });\n        return allowed;\n      });\n    }\n    /**\n     * Returns all the child keys for the object identified by the generic prefix,\n     * or all the top level keys if no prefix is supplied.\n     *\n     * @param {String} [keyPrefix] The Object-type generic key for which to get child keys. Omit for\n     *   top-level Object-type keys\n     * @returns {[[Type]]} [[Description]]\n     */\n\n  }, {\n    key: \"objectKeys\",\n    value: function objectKeys(keyPrefix) {\n      if (!keyPrefix) return this._firstLevelSchemaKeys;\n      return this._objectKeys[\"\".concat(keyPrefix, \".\")] || [];\n    }\n    /**\n     * Copies this schema into a new instance with the same validators, messages,\n     * and options, but with different keys as defined in `schema` argument\n     *\n     * @param {Object} schema\n     * @returns The new SimpleSchema instance (chainable)\n     */\n\n  }, {\n    key: \"_copyWithSchema\",\n    value: function _copyWithSchema(schema) {\n      var cl = new SimpleSchema(schema, _objectSpread({}, this._constructorOptions));\n      cl._cleanOptions = this._cleanOptions;\n      cl.messageBox = this.messageBox.clone();\n      return cl;\n    }\n    /**\n     * Clones this schema into a new instance with the same schema keys, validators,\n     * and options.\n     *\n     * @returns The new SimpleSchema instance (chainable)\n     */\n\n  }, {\n    key: \"clone\",\n    value: function clone() {\n      return this._copyWithSchema(this._schema);\n    }\n    /**\n     * Extends (mutates) this schema with another schema, key by key.\n     *\n     * @param {SimpleSchema|Object} schema\n     * @returns The SimpleSchema instance (chainable)\n     */\n\n  }, {\n    key: \"extend\",\n    value: function extend() {\n      var _this8 = this;\n\n      var schema = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      if (Array.isArray(schema)) throw new Error('You may not pass an array of schemas to the SimpleSchema constructor or to extend()');\n      var schemaObj;\n\n      if (SimpleSchema.isSimpleSchema(schema)) {\n        schemaObj = schema._schema;\n        this._validators = this._validators.concat(schema._validators);\n        this._docValidators = this._docValidators.concat(schema._docValidators);\n        Object.assign(this._cleanOptions, schema._cleanOptions);\n        Object.assign(this._constructorOptions, schema._constructorOptions);\n      } else {\n        schemaObj = (0, _expandShorthand.default)(schema);\n      }\n\n      var schemaKeys = Object.keys(schemaObj);\n      var combinedKeys = new Set([].concat(_toConsumableArray(Object.keys(this._schema)), _toConsumableArray(schemaKeys))); // Update all of the information cached on the instance\n\n      schemaKeys.forEach(function (fieldName) {\n        var definition = standardizeDefinition(schemaObj[fieldName]); // Merge/extend with any existing definition\n\n        if (_this8._schema[fieldName]) {\n          if (!Object.prototype.hasOwnProperty.call(_this8._schema, fieldName)) {\n            // fieldName is actually a method from Object itself!\n            throw new Error(\"\".concat(fieldName, \" key is actually the name of a method on Object, please rename it\"));\n          }\n\n          var type = definition.type,\n              definitionWithoutType = _objectWithoutProperties(definition, [\"type\"]); // eslint-disable-line no-unused-vars\n\n\n          _this8._schema[fieldName] = _objectSpread({}, _this8._schema[fieldName], {}, definitionWithoutType);\n          if (definition.type) _this8._schema[fieldName].type.extend(definition.type);\n        } else {\n          _this8._schema[fieldName] = definition;\n        }\n\n        checkAndScrubDefinition(fieldName, _this8._schema[fieldName], _this8._constructorOptions, combinedKeys);\n      });\n      checkSchemaOverlap(this._schema); // Set/Reset all of these\n\n      this._schemaKeys = Object.keys(this._schema);\n      this._autoValues = [];\n      this._blackboxKeys = new Set();\n      this._firstLevelSchemaKeys = [];\n      this._objectKeys = {}; // Update all of the information cached on the instance\n\n      this._schemaKeys.forEach(function (fieldName) {\n        // Make sure parent has a definition in the schema. No implied objects!\n        if (fieldName.indexOf('.') > -1) {\n          var parentFieldName = fieldName.slice(0, fieldName.lastIndexOf('.'));\n          if (!Object.prototype.hasOwnProperty.call(_this8._schema, parentFieldName)) throw new Error(\"\\\"\".concat(fieldName, \"\\\" is in the schema but \\\"\").concat(parentFieldName, \"\\\" is not\"));\n        }\n\n        var definition = _this8._schema[fieldName]; // Keep list of all top level keys\n\n        if (fieldName.indexOf('.') === -1) _this8._firstLevelSchemaKeys.push(fieldName); // Keep list of all blackbox keys for passing to MongoObject constructor\n        // XXX For now if any oneOf type is blackbox, then the whole field is.\n\n        /* eslint-disable no-restricted-syntax */\n\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          for (var _iterator = definition.type.definitions[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var oneOfDef = _step.value;\n\n            // XXX If the type is SS.Any, also consider it a blackbox\n            if (oneOfDef.blackbox === true || oneOfDef.type === SimpleSchema.Any) {\n              _this8._blackboxKeys.add(fieldName);\n\n              break;\n            }\n          }\n          /* eslint-enable no-restricted-syntax */\n          // Keep list of autoValue functions\n\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator.return != null) {\n              _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n\n        if (typeof definition.autoValue === 'function') {\n          _this8._autoValues.push({\n            closestSubschemaFieldName: '',\n            fieldName: fieldName,\n            func: definition.autoValue\n          });\n        }\n      }); // Store child keys keyed by parent. This needs to be done recursively to handle\n      // subschemas.\n\n\n      var setObjectKeys = function setObjectKeys(curSchema, schemaParentKey) {\n        Object.keys(curSchema).forEach(function (fieldName) {\n          var definition = curSchema[fieldName];\n          fieldName = schemaParentKey ? \"\".concat(schemaParentKey, \".\").concat(fieldName) : fieldName;\n\n          if (fieldName.indexOf('.') > -1 && fieldName.slice(-2) !== '.$') {\n            var parentKey = fieldName.slice(0, fieldName.lastIndexOf('.'));\n            var parentKeyWithDot = \"\".concat(parentKey, \".\");\n            _this8._objectKeys[parentKeyWithDot] = _this8._objectKeys[parentKeyWithDot] || [];\n\n            _this8._objectKeys[parentKeyWithDot].push(fieldName.slice(fieldName.lastIndexOf('.') + 1));\n          } // If the current field is a nested SimpleSchema,\n          // iterate over the child fields and cache their properties as well\n\n\n          definition.type.definitions.forEach(function (_ref2) {\n            var type = _ref2.type;\n\n            if (SimpleSchema.isSimpleSchema(type)) {\n              setObjectKeys(type._schema, fieldName);\n            }\n          });\n        });\n      };\n\n      setObjectKeys(this._schema);\n      return this;\n    }\n  }, {\n    key: \"getAllowedValuesForKey\",\n    value: function getAllowedValuesForKey(key) {\n      // For array fields, `allowedValues` is on the array item definition\n      if (this.allowsKey(\"\".concat(key, \".$\"))) {\n        key = \"\".concat(key, \".$\");\n      }\n\n      var allowedValues = this.get(key, 'allowedValues');\n\n      if (Array.isArray(allowedValues) || allowedValues instanceof Set) {\n        return _toConsumableArray(allowedValues);\n      }\n\n      return null;\n    }\n  }, {\n    key: \"newContext\",\n    value: function newContext() {\n      return new _ValidationContext.default(this);\n    }\n  }, {\n    key: \"namedContext\",\n    value: function namedContext(name) {\n      if (typeof name !== 'string') name = 'default';\n\n      if (!this._validationContexts[name]) {\n        this._validationContexts[name] = new _ValidationContext.default(this, name);\n      }\n\n      return this._validationContexts[name];\n    }\n  }, {\n    key: \"addValidator\",\n    value: function addValidator(func) {\n      this._validators.push(func);\n    }\n  }, {\n    key: \"addDocValidator\",\n    value: function addDocValidator(func) {\n      this._docValidators.push(func);\n    }\n    /**\n     * @param obj {Object|Object[]} Object or array of objects to validate.\n     * @param [options] {Object} Same options object that ValidationContext#validate takes\n     *\n     * Throws an Error with name `ClientError` and `details` property containing the errors.\n     */\n\n  }, {\n    key: \"validate\",\n    value: function validate(obj) {\n      var _this9 = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      // For Meteor apps, `check` option can be passed to silence audit-argument-checks\n      var check = options.check || this._constructorOptions.check;\n\n      if (typeof check === 'function') {\n        // Call check but ignore the error\n        try {\n          check(obj);\n        } catch (e) {\n          /* ignore error */\n        }\n      } // obj can be an array, in which case we validate each object in it and\n      // throw as soon as one has an error\n\n\n      var objects = Array.isArray(obj) ? obj : [obj];\n      objects.forEach(function (oneObj) {\n        var validationContext = _this9.newContext();\n\n        var isValid = validationContext.validate(oneObj, options);\n        if (isValid) return;\n        var errors = validationContext.validationErrors(); // In order for the message at the top of the stack trace to be useful,\n        // we set it to the first validation error message.\n\n        var message = _this9.messageForError(errors[0]);\n\n        var error = new Error(message);\n        error.errorType = 'ClientError';\n        error.name = 'ClientError';\n        error.error = 'validation-error'; // Add meaningful error messages for each validation error.\n        // Useful for display messages when using 'mdg:validated-method'.\n\n        error.details = errors.map(function (errorDetail) {\n          return _objectSpread({}, errorDetail, {\n            message: _this9.messageForError(errorDetail)\n          });\n        }); // The primary use for the validationErrorTransform is to convert the\n        // vanilla Error into a Meteor.Error until DDP is able to pass\n        // vanilla errors back to the client.\n\n        if (typeof SimpleSchema.validationErrorTransform === 'function') {\n          throw SimpleSchema.validationErrorTransform(error);\n        } else {\n          throw error;\n        }\n      });\n    }\n    /**\n     * @param obj {Object} Object to validate.\n     * @param [options] {Object} Same options object that ValidationContext#validate takes\n     *\n     * Returns a Promise that resolves with the errors\n     */\n\n  }, {\n    key: \"validateAndReturnErrorsPromise\",\n    value: function validateAndReturnErrorsPromise(obj, options) {\n      var _this10 = this;\n\n      var validationContext = this.newContext();\n      var isValid = validationContext.validate(obj, options);\n      if (isValid) return Promise.resolve([]); // Add the `message` prop\n\n      var errors = validationContext.validationErrors().map(function (errorDetail) {\n        return _objectSpread({}, errorDetail, {\n          message: _this10.messageForError(errorDetail)\n        });\n      });\n      return Promise.resolve(errors);\n    }\n  }, {\n    key: \"validator\",\n    value: function validator() {\n      var _this11 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      return function (obj) {\n        var optionsClone = _objectSpread({}, options);\n\n        if (options.clean === true) {\n          // Do this here and pass into both functions for better performance\n          optionsClone.mongoObject = new _mongoObject.default(obj, _this11.blackboxKeys());\n\n          _this11.clean(obj, optionsClone);\n        }\n\n        if (options.returnErrorsPromise) {\n          return _this11.validateAndReturnErrorsPromise(obj, optionsClone);\n        }\n\n        return _this11.validate(obj, optionsClone);\n      };\n    }\n  }, {\n    key: \"getFormValidator\",\n    value: function getFormValidator() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      return this.validator(_objectSpread({}, options, {\n        returnErrorsPromise: true\n      }));\n    }\n  }, {\n    key: \"clean\",\n    value: function clean() {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return _clean2.default.apply(void 0, [this].concat(args));\n    }\n    /**\n     * Change schema labels on the fly, causing mySchema.label computation\n     * to rerun. Useful when the user changes the language.\n     *\n     * @param {Object} labels A dictionary of all the new label values, by schema key.\n     */\n\n  }, {\n    key: \"labels\",\n    value: function labels(_labels) {\n      var _this12 = this;\n\n      Object.keys(_labels).forEach(function (key) {\n        var label = _labels[key];\n        if (typeof label !== 'string' && typeof label !== 'function') return;\n\n        var _this12$nearestSimple = _this12.nearestSimpleSchemaInstance(key),\n            _this12$nearestSimple2 = _slicedToArray(_this12$nearestSimple, 2),\n            schemaInstance = _this12$nearestSimple2[0],\n            innerKey = _this12$nearestSimple2[1];\n\n        if (!schemaInstance) return;\n        schemaInstance._schema[innerKey].label = label;\n        schemaInstance._depsLabels[innerKey] && schemaInstance._depsLabels[innerKey].changed();\n      });\n    }\n    /**\n     * Gets a field's label or all field labels reactively.\n     *\n     * @param {String} [key] The schema key, specific or generic.\n     *   Omit this argument to get a dictionary of all labels.\n     * @returns {String} The label\n     */\n\n  }, {\n    key: \"label\",\n    value: function label(key) {\n      var _this13 = this;\n\n      // Get all labels\n      if (key === null || key === undefined) {\n        var result = {};\n\n        this._schemaKeys.forEach(function (schemaKey) {\n          result[schemaKey] = _this13.label(schemaKey);\n        });\n\n        return result;\n      } // Get label for one field\n\n\n      var label = this.get(key, 'label');\n      if (label) this.reactiveLabelDependency(key);\n      return label || null;\n    }\n    /**\n     * Gets a field's property\n     *\n     * @param {String} key The schema key, specific or generic.\n     * @param {String} prop Name of the property to get for that schema key\n     * @param {Object} [functionContext] The `this` context to use if prop is a function\n     * @returns {any} The property value\n     */\n\n  }, {\n    key: \"get\",\n    value: function get(key, prop, functionContext) {\n      var def = this.getDefinition(key, ['type', prop], functionContext);\n      if (!def) return undefined;\n\n      if (schemaDefinitionOptions.includes(prop)) {\n        return def[prop];\n      }\n\n      return (def.type.find(function (props) {\n        return props[prop];\n      }) || {})[prop];\n    } // shorthand for getting defaultValue\n\n  }, {\n    key: \"defaultValue\",\n    value: function defaultValue(key) {\n      return this.get(key, 'defaultValue');\n    } // Returns a string message for the given error type and key. Passes through\n    // to message-box pkg.\n\n  }, {\n    key: \"messageForError\",\n    value: function messageForError(errorInfo) {\n      var name = errorInfo.name;\n      return this.messageBox.message(errorInfo, {\n        context: {\n          key: name,\n          // backward compatibility\n          // The call to this.label() establishes a reactive dependency, too\n          label: this.label(name)\n        }\n      });\n    }\n    /**\n     * @method SimpleSchema#pick\n     * @param {[fields]} The list of fields to pick to instantiate the subschema\n     * @returns {SimpleSchema} The subschema\n     */\n\n  }], [{\n    key: \"isSimpleSchema\",\n    value: function isSimpleSchema(obj) {\n      return obj && (obj instanceof SimpleSchema || obj._schema);\n    }\n  }, {\n    key: \"extendOptions\",\n    // If you need to allow properties other than those listed above, call this from your app or package\n    value: function extendOptions(options) {\n      // For backwards compatibility we still take an object here, but we only care about the names\n      if (!Array.isArray(options)) options = Object.keys(options);\n      options.forEach(function (option) {\n        schemaDefinitionOptions.push(option);\n      });\n    }\n  }, {\n    key: \"defineValidationErrorTransform\",\n    value: function defineValidationErrorTransform(transform) {\n      if (typeof transform !== 'function') {\n        throw new Error('SimpleSchema.defineValidationErrorTransform must be passed a function that accepts an Error and returns an Error');\n      }\n\n      SimpleSchema.validationErrorTransform = transform;\n    }\n  }, {\n    key: \"validate\",\n    value: function validate(obj, schema, options) {\n      // Allow passing just the schema object\n      if (!SimpleSchema.isSimpleSchema(schema)) {\n        schema = new SimpleSchema(schema);\n      }\n\n      return schema.validate(obj, options);\n    }\n  }, {\n    key: \"oneOf\",\n    value: function oneOf() {\n      for (var _len2 = arguments.length, definitions = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        definitions[_key2] = arguments[_key2];\n      }\n\n      return _construct(_SimpleSchemaGroup.default, definitions);\n    }\n  }, {\n    key: \"addValidator\",\n    value: function addValidator(func) {\n      SimpleSchema._validators.push(func);\n    }\n  }, {\n    key: \"addDocValidator\",\n    value: function addDocValidator(func) {\n      SimpleSchema._docValidators.push(func);\n    } // Global constructor options\n\n  }, {\n    key: \"constructorOptionDefaults\",\n\n    /**\n     * @summary Get/set default values for SimpleSchema constructor options\n     */\n    value: function constructorOptionDefaults(options) {\n      if (!options) return SimpleSchema._constructorOptionDefaults;\n      SimpleSchema._constructorOptionDefaults = _objectSpread({}, SimpleSchema._constructorOptionDefaults, {}, options, {\n        clean: _objectSpread({}, SimpleSchema._constructorOptionDefaults.clean, {}, options.clean || {})\n      });\n    }\n  }]);\n\n  return SimpleSchema;\n}();\n/*\n * PRIVATE\n */\n// Throws an error if any fields are `type` SimpleSchema but then also\n// have subfields defined outside of that.\n\n\nexports.SimpleSchema = SimpleSchema;\n\n_defineProperty(SimpleSchema, \"version\", 2);\n\n_defineProperty(SimpleSchema, \"Any\", '___Any___');\n\n_defineProperty(SimpleSchema, \"RegEx\", _regExp.default);\n\n_defineProperty(SimpleSchema, \"_validators\", []);\n\n_defineProperty(SimpleSchema, \"_docValidators\", []);\n\n_defineProperty(SimpleSchema, \"_constructorOptionDefaults\", {\n  clean: {\n    autoConvert: true,\n    extendAutoValueContext: {},\n    filter: true,\n    getAutoValues: true,\n    removeEmptyStrings: true,\n    removeNullsFromArrays: false,\n    trimStrings: true\n  },\n  humanizeAutoLabels: true,\n  requiredByDefault: true\n});\n\n_defineProperty(SimpleSchema, \"ErrorTypes\", {\n  REQUIRED: 'required',\n  MIN_STRING: 'minString',\n  MAX_STRING: 'maxString',\n  MIN_NUMBER: 'minNumber',\n  MAX_NUMBER: 'maxNumber',\n  MIN_NUMBER_EXCLUSIVE: 'minNumberExclusive',\n  MAX_NUMBER_EXCLUSIVE: 'maxNumberExclusive',\n  MIN_DATE: 'minDate',\n  MAX_DATE: 'maxDate',\n  BAD_DATE: 'badDate',\n  MIN_COUNT: 'minCount',\n  MAX_COUNT: 'maxCount',\n  MUST_BE_INTEGER: 'noDecimal',\n  VALUE_NOT_ALLOWED: 'notAllowed',\n  EXPECTED_TYPE: 'expectedType',\n  FAILED_REGULAR_EXPRESSION: 'regEx',\n  KEY_NOT_IN_SCHEMA: 'keyNotInSchema'\n});\n\n_defineProperty(SimpleSchema, \"Integer\", 'SimpleSchema.Integer');\n\n_defineProperty(SimpleSchema, \"_makeGeneric\", _mongoObject.default.makeKeyGeneric);\n\n_defineProperty(SimpleSchema, \"ValidationContext\", _ValidationContext.default);\n\n_defineProperty(SimpleSchema, \"setDefaultMessages\", function (messages) {\n  (0, _utility.merge)(_defaultMessages.default, messages);\n});\n\nfunction checkSchemaOverlap(schema) {\n  Object.keys(schema).forEach(function (key) {\n    var val = schema[key];\n    if (!val.type) throw new Error(\"\".concat(key, \" key is missing \\\"type\\\"\"));\n    val.type.definitions.forEach(function (def) {\n      if (!SimpleSchema.isSimpleSchema(def.type)) return;\n      Object.keys(def.type._schema).forEach(function (subKey) {\n        var newKey = \"\".concat(key, \".\").concat(subKey);\n\n        if (Object.prototype.hasOwnProperty.call(schema, newKey)) {\n          throw new Error(\"The type for \\\"\".concat(key, \"\\\" is set to a SimpleSchema instance that defines \\\"\").concat(key, \".\").concat(subKey, \"\\\", but the parent SimpleSchema instance also tries to define \\\"\").concat(key, \".\").concat(subKey, \"\\\"\"));\n        }\n      });\n    });\n  });\n}\n/**\n * @param {String} fieldName The full generic schema key\n * @param {Boolean} shouldHumanize Humanize it\n * @returns {String} A label based on the key\n */\n\n\nfunction inflectedLabel(fieldName, shouldHumanize) {\n  var pieces = fieldName.split('.');\n  var label;\n\n  do {\n    label = pieces.pop();\n  } while (label === '$' && pieces.length);\n\n  return shouldHumanize ? (0, _humanize.default)(label) : label;\n}\n\nfunction getDefaultAutoValueFunction(defaultValue) {\n  return function defaultAutoValueFunction() {\n    if (this.isSet) return;\n    if (this.operator === null) return defaultValue; // Handle the case when pulling an object from an array the object contains a field\n    // which has a defaultValue. We don't want the default value to be returned in this case\n\n    if (this.operator === '$pull') return; // Handle the case where we are $pushing an object into an array of objects and we\n    // want any fields missing from that object to be added if they have default values\n\n    if (this.operator === '$push') return defaultValue; // If parent is set, we should update this position instead of $setOnInsert\n\n    if (this.parentField().isSet) return defaultValue; // Make sure the default value is added on upsert insert\n\n    if (this.isUpsert) return {\n      $setOnInsert: defaultValue\n    };\n  };\n} // Mutates def into standardized object with SimpleSchemaGroup type\n\n\nfunction standardizeDefinition(def) {\n  var standardizedDef = Object.keys(def).reduce(function (newDef, prop) {\n    if (!oneOfProps.includes(prop)) {\n      newDef[prop] = def[prop];\n    }\n\n    return newDef;\n  }, {}); // Internally, all definition types are stored as groups for simplicity of access.\n  // If we are extending, there may not actually be def.type, but it's okay because\n  // it will be added later when the two SimpleSchemaGroups are merged.\n\n  if (def.type && def.type instanceof _SimpleSchemaGroup.default) {\n    standardizedDef.type = def.type.clone();\n  } else {\n    var groupProps = Object.keys(def).reduce(function (newDef, prop) {\n      if (oneOfProps.includes(prop)) {\n        newDef[prop] = def[prop];\n      }\n\n      return newDef;\n    }, {});\n    standardizedDef.type = new _SimpleSchemaGroup.default(groupProps);\n  }\n\n  return standardizedDef;\n}\n/**\n * @summary Checks and mutates definition. Clone it first.\n *   Throws errors if any problems are found.\n * @param {String} fieldName Name of field / key\n * @param {Object} definition Field definition\n * @param {Object} options Options\n * @param {Set} allKeys Set of all field names / keys in entire schema\n * @return {undefined} Void\n */\n\n\nfunction checkAndScrubDefinition(fieldName, definition, options, allKeys) {\n  if (!definition.type) throw new Error(\"\".concat(fieldName, \" key is missing \\\"type\\\"\")); // Validate the field definition\n\n  Object.keys(definition).forEach(function (key) {\n    if (schemaDefinitionOptions.indexOf(key) === -1) {\n      throw new Error(\"Invalid definition for \".concat(fieldName, \" field: \\\"\").concat(key, \"\\\" is not a supported property\"));\n    }\n  }); // Make sure the `type`s are OK\n\n  var couldBeArray = false;\n  definition.type.definitions.forEach(function (_ref3) {\n    var type = _ref3.type;\n    if (!type) throw new Error(\"Invalid definition for \".concat(fieldName, \" field: \\\"type\\\" option is required\"));\n\n    if (Array.isArray(type)) {\n      throw new Error(\"Invalid definition for \".concat(fieldName, \" field: \\\"type\\\" may not be an array. Change it to Array.\"));\n    }\n\n    if (type.constructor === Object && (0, _utility.isEmptyObject)(type)) {\n      throw new Error(\"Invalid definition for \".concat(fieldName, \" field: \\\"type\\\" may not be an object. Change it to Object\"));\n    }\n\n    if (type === Array) couldBeArray = true;\n\n    if (SimpleSchema.isSimpleSchema(type)) {\n      Object.keys(type._schema).forEach(function (subKey) {\n        var newKey = \"\".concat(fieldName, \".\").concat(subKey);\n\n        if (allKeys.has(newKey)) {\n          throw new Error(\"The type for \\\"\".concat(fieldName, \"\\\" is set to a SimpleSchema instance that defines \\\"\").concat(newKey, \"\\\", but the parent SimpleSchema instance also tries to define \\\"\").concat(newKey, \"\\\"\"));\n        }\n      });\n    }\n  }); // If at least one of the possible types is Array, then make sure we have a\n  // definition for the array items, too.\n\n  if (couldBeArray && !allKeys.has(\"\".concat(fieldName, \".$\"))) {\n    throw new Error(\"\\\"\".concat(fieldName, \"\\\" is Array type but the schema does not include a \\\"\").concat(fieldName, \".$\\\" definition for the array items\\\"\"));\n  } // defaultValue -> autoValue\n  // We support defaultValue shortcut by converting it immediately into an\n  // autoValue.\n\n\n  if ('defaultValue' in definition) {\n    if ('autoValue' in definition && !definition.autoValue.isDefault) {\n      console.warn(\"SimpleSchema: Found both autoValue and defaultValue options for \\\"\".concat(fieldName, \"\\\". Ignoring defaultValue.\"));\n    } else {\n      if (fieldName.endsWith('.$')) {\n        throw new Error('An array item field (one that ends with \".$\") cannot have defaultValue.');\n      }\n\n      definition.autoValue = getDefaultAutoValueFunction(definition.defaultValue);\n      definition.autoValue.isDefault = true;\n    }\n  } // REQUIREDNESS\n\n\n  if (fieldName.endsWith('.$')) {\n    definition.optional = true;\n  } else if (!Object.prototype.hasOwnProperty.call(definition, 'optional')) {\n    if (Object.prototype.hasOwnProperty.call(definition, 'required')) {\n      if (typeof definition.required === 'function') {\n        definition.optional = function optional() {\n          for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n            args[_key3] = arguments[_key3];\n          }\n\n          return !definition.required.apply(this, args);\n        };\n      } else {\n        definition.optional = !definition.required;\n      }\n    } else {\n      definition.optional = options.requiredByDefault === false;\n    }\n  }\n\n  delete definition.required; // LABELS\n\n  if (!Object.prototype.hasOwnProperty.call(definition, 'label')) {\n    if (options.defaultLabel) {\n      definition.label = options.defaultLabel;\n    } else if (SimpleSchema.defaultLabel) {\n      definition.label = SimpleSchema.defaultLabel;\n    } else {\n      definition.label = inflectedLabel(fieldName, options.humanizeAutoLabels);\n    }\n  }\n}\n\nfunction getPickOrOmit(type) {\n  return function pickOrOmit() {\n    var _this14 = this;\n\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    }\n\n    // If they are picking/omitting an object or array field, we need to also include everything under it\n    var newSchema = {};\n\n    this._schemaKeys.forEach(function (key) {\n      // Pick/omit it if it IS in the array of keys they want OR if it\n      // STARTS WITH something that is in the array plus a period\n      var includeIt = args.some(function (wantedField) {\n        return key === wantedField || key.indexOf(\"\".concat(wantedField, \".\")) === 0;\n      });\n\n      if (includeIt && type === 'pick' || !includeIt && type === 'omit') {\n        newSchema[key] = _this14._schema[key];\n      }\n    });\n\n    return this._copyWithSchema(newSchema);\n  };\n}"]},"metadata":{},"sourceType":"script"}